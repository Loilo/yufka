# Falafel

This document yields information about how Yufka relates to the [Falafel](https://www.npmjs.com/package/falafel) package.

## Origins

Yufka started out as a fork of Falafel with only the `node.source()` naming conflict fixed. However, during development, it became clear that what we wanted was a kind of modern, actively maintained version of Falafel.

In addition, we read through the open issues of the Falafel repository and drew some ideas for useful features from there.

Eventually, nothing from the original Falafel codebase has survived the several refactors. However, fragments of the documentation are still the same.

## Benefits

The following lists what, in my humble opinion, Yufka does better than Falafel (besides being actively maintained):

### TypeScript

Yufka is written in TypeScript. This means that modern IDEs can provide type hints when using Yufka, just from installing it.

### Future-proof

Yufka completely forgoes modifying third-party objects (namely the acorn AST nodes). This makes it more robust than Falafel in terms of new syntax and thus new types of AST nodes.

### Predictable Asynchronousity

Yufka offers usage of Promises to write asynchronous manipulations. All actions that are invoked outside this standardized control flow will result in errors being thrown.

### Source Maps

Yufka creates source maps, in case you need them. End of story.

## Differences

Yufka is not a drop-in replacement for Falafel. Due to the architectural decisions made for Yufka, there are some differences in usage:

### Methods

For namespacing reasons, the `source()`, `parent` and `update()` properties are not attached to the respective AST nodes directly but are instead exposed through a helper object passed to the manipulator function.

### Options Structure

While Falafel only accepted acorn options plus a `parser` option, it seems reasonable to put all of that into a large dictionary object.

However, Yufka's options have a little more variety, therefore all the acorn options migrated to their own namespace in `options.acorn`.

### Asynchronousity

Falafel's asynchronous updates seem a bit dated â€” it lets you update nodes basically whenever you want, which means that the returned object may change at any point in time without the user noticing.

Yufka on the other hand offers a very explicit interface for asynchronous updates through usage of Promises. All actions that are invoked outside this standardized control flow will result in errors being thrown.

## Resolved Issues

This is a list of Falafel issues/feature requests that are resolved in Yufka:

### Naming Conflicts

A variety of open issues stem from the modifications Falafel does to the AST nodes which conflict with more recent JavaScript node types.

Yufka avoids these problems by not touching third-party objects at all.

- [Name conflict in falafel's dynamic patching (#17)](https://github.com/substack/node-falafel/issues/17)
- [Incompatibility between falafel and escodegen (#36)](https://github.com/substack/node-falafel/issues/36)
- [Property name conflict with ES6 modules (#45)](https://github.com/substack/node-falafel/issues/45)
- [node.source property is overwriting by node-falafel node.source() function (#63)](https://github.com/substack/node-falafel/issues/63)

### Node.js Runtime

- [Fix Buffer (#68)](https://github.com/substack/node-falafel/issues/68)

  The old way of creating Buffers had been deprecated.

- [Fix inspect warning (#69)](https://github.com/substack/node-falafel/issues/69)

  Custom inspections are not used in Yufka.

### Features

- [Source Mapping support (#19)](https://github.com/substack/node-falafel/issues/19)

  Source maps are always generated by Yufka.
